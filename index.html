<html>
    <head>

        <title>Диплом</title>
        <script src="socket.io/socket.io.js"></script>
        <script>
            var clientSocket =null;
            window.onload = function(){

                var otherPeers = [];
                
                var offerSent = false;
                var stream =null;
                var clientSocket = io.connect("http://web-streamer.herokuapp.com:80",{secure: true, reconnect:true});
                


                

            
                navigator.getUserMedia = navigator.getUserMedia ||
                         navigator.webkitGetUserMedia ||
                         navigator.mozGetUserMedia;

                        if (navigator.getUserMedia) {
                        navigator.getUserMedia({ audio: true, video: { width: 1280, height: 720 } },
                            function(stream) {
                                
                                clientSocket.on('connect',(socket)=>{
                                    console.log("connected to server!");

                                    socket.emit("stream",stream)


                                });

                                clientSocket.on('stream',(stream)=>{
                                    console.log("GetToServerStream");

                                    var video = document.querySelector('videostreamOutput');
                                    video.srcObject = stream;
                                    video.onloadedmetadata = function(e) {
                                    video.play();
                                    };


                                });


                                var video = document.querySelector('#MyStream');
                                video.srcObject = stream;
                                video.onloadedmetadata = function(e) {
                                video.play();
                                };
                            },
                            function(err) {
                                console.log("The following error occurred: " + err.name);
                            }
                        );
                        } else {
                        console.log("getUserMedia not supported");
                        }

                    window.URL = window.URL || window.webkitURL;
                    console.log("stream");
                

                   
                

                
            };
            
        </script>
    </head>
    <body>
        <h1>webrtc</h1>
        <video id="videostreamOutput" width="300" autoplay playsinline></video>
        <video id="myStream"  width="300" autoplay playsinline ></video>
    </body>
</html>