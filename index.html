<html>
    <head>

        <title>Диплом</title>
        <script src="socket.io/socket.io.js"></script>
        <script>
            var clientSocket =null;
            window.onload = function(){

                var otherPeers = [];
                
                var offerSent = false;
                var stream =null;
                var constraints = { audio: true, video: { width: 1280, height: 720 } }; 


                

            
                navigator.getUserMedia = navigator.getUserMedia ||
                         navigator.webkitGetUserMedia ||
                         navigator.mozGetUserMedia;

                        if (navigator.getUserMedia) {
                        navigator.getUserMedia({ audio: true, video: { width: 1280, height: 720 } },
                            function(stream) {
                                var video = document.querySelector('video');
                                video.srcObject = stream;
                                video.onloadedmetadata = function(e) {
                                video.play();
                                };
                            },
                            function(err) {
                                console.log("The following error occurred: " + err.name);
                            }
                        );
                        } else {
                            navigator.mediaDevices.getUserMedia(constraints)
                            .then(function(mediaStream) {
                            var video = document.querySelector('video');
                            video.srcObject = mediaStream;
                            video.onloadedmetadata = function(e) {
                                video.play();
                            };
                            })
                            .catch(function(err) { console.log(err.name + ": " + err.message); });
                            console.log("getUserMedia not supported");
                        }

                    window.URL = window.URL || window.webkitURL;
                    console.log("stream");
                

                   
                

                function setupClient(){
                    clientSocket = io.connect();



                    function gotOfferDescription(desc){
                        pc.setLocalDescription(desc);
                        clientSocket.emit('server_socket', {type:'description', info:desc});
                    }

                    function gotAnswerDescription(desc){
                        pc.setLocalDescription(desc);
                        clientSocket.emit('server_socket', {type:'description', info:desc});
                    }

                    pc.onicecandidate = function(event){
                        if(event.candidate){
                            clientSocket.emit('server_socket', {type:'candidate', info:event.candidate});
                        }
                    };

                    pc.onaddstream = function(el){
                        document.getElementById('videostreamOutput').src = webkitURL.createObjectURL(e.stream);
                    };

                    pc.onerror = function(){
                        //error
                    };
                };

                
            };
            
        </script>
    </head>
    <body>
        <h1>webrtc</h1>
        <video id="videostreamOutput" width="300" autoplay playsinline></video>
        <video id="myStream"  width="300" autoplay playsinline ></video>
    </body>
</html>