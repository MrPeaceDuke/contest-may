<html>
    <head>

        <title>Диплом</title>
        <script src="socket.io/socket.io.js"></script>
        
        <script>
            var ss = require('socket.io-stream');
            var clientSocket =null;
            window.onload = function(){

                var otherPeers = [];
                
                var offerSent = false;
                var stream =null;
                var clientSocket = io.connect();
                var SocketStream = ss.createStream();

                clientSocket.on('connect',(socket)=>{
                    console.log("connected to server!");

                    navigator.getUserMedia = navigator.getUserMedia ||
                         navigator.webkitGetUserMedia ||
                         navigator.mozGetUserMedia;

                        if (navigator.getUserMedia) {
                        navigator.getUserMedia({ audio: true, video: { width: 1280, height: 720 } },
                            function(stream) {
                                console.log("prestream");
                                    console.log(stream);
                                    
                                    ss(clientSocket).emit("stream", SocketStream, stream);
                                    fs.createReadStream(stream).pipe(SocketStream);
                                    console.log("sendStream");
                                
                                console.log("end stream");

                                var video = document.querySelector('#myStream');
                                video.srcObject = stream;
                                video.onloadedmetadata = function(e) 
                                    {
                                    video.play();
                                    };

                                
                            },
                            function(err) {
                                console.log("The following error occurred: " + err.name);
                            }
                        );
                        } else {
                        console.log("getUserMedia not supported");
                        }


                    console.log("stream");
                    
                    console.log("Wait Stream");
                    clientSocket.on("stream",(stream)=>{
                        console.log("Stream get");
                        console.log(stream);
                        var video = document.querySelector('#videostreamOutput');
                        video.srcObject = stream;
                        video.onloadedmetadata = function(e) 
                            {
                            video.play();
                            };
                    });

                    


                });

                


                

            
                
                

                   
                

                
            };
            
        </script>
    </head>
    <body>
        <h1>webrtc</h1>
        <video id="videostreamOutput" width="300" autoplay playsinline></video>
        <video id="myStream"  width="300" autoplay playsinline ></video>
    </body>
</html>