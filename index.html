<html>
    <head>

        <title>Диплом</title>
        <script src="socket.io/socket.io.js"></script>
        <script>
                var canvas = document.getElementById("preview");
                var context = canvas.getContext('2d');
            
                canvas.width = 900;
                canvas.height = 700;
            
                context.width = canvas.width;
                context.height = canvas.height;
            
                var video = document.getElementById("myStream");
            
                var socket = io();
            
                function logger(msg){
                    $('#logger').text(msg);
                }
            
                function loadCamera(stream){
                try {
                    video.srcObject = stream;
                    } catch (error) {
                video.src = URL.createObjectURL(stream);
                    }
                logger("Camera connected");
                }
            
                function loadFail(){
                    logger("Camera not connected");
                }
            
                function viewVideo(video,context){
                    context.drawImage(video,0,0,context.width,context.height);
                    socket.emit('stream',canvas.toDataURL('image/webp'));
                }
            
                $(function(){
                    navigator.getUserMedia = ( navigator.getUserMedia || navigator.webkitGetUserMedia || navigator.mozGetUserMedia || navigator.msgGetUserMedia );
                
                    if(navigator.getUserMedia){
                        navigator.getUserMedia({video: true, audio: false},loadCamera,loadFail);
                    }
            
                    setInterval(function(){
                        viewVideo(video,context);
                    },5);
                });
            
        </script>
    </head>
    <body>
        <h1>webrtc</h1>
        <video id="videostreamOutput" width="300" autoplay playsinline></video>
        <video id="preview"  width="300" autoplay playsinline ></video>
        <video id="myStream"  width="300" autoplay playsinline ></video>
    </body>
</html>